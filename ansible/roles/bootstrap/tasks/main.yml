# Boostraps a basic vagrant environment

- name: Upgrade aptitude packages.
  command: apt upgrade -y -qq
  become: yes

- name: Set root password.
  become: yes
  user:
    name: "root"
    password: "root"

- name: Copy sudoers, edit copy.
  become: yes
  command: cp -f /etc/sudoers /etc/sudoers.tmp

- name: Backup original sudoers file.
  become: yes
  command: cp -f /etc/sudoers /etc/sudoers.bak

- name: Enable passwordless sudo for 'deploy' user.
  become: yes
  lineinfile: "dest=/etc/sudoers.tmp state=present regexp='^deploy' line='deploy ALL=(ALL) NOPASSWD: ALL'"

- name: Ensure ssh-agent works via sudo.
  become: yes
  lineinfile: dest=/etc/sudoers.tmp state=present regexp='^Defaults env_keep\+\=SSH_AUTH_SOCK' line='Defaults env_keep+=SSH_AUTH_SOCK'

- name: Check and install modified sudoers file.
  become: yes
  shell: visudo -q -c -f /etc/sudoers.tmp && cp -f /etc/sudoers.tmp /etc/sudoers

- name: Set box hostname.
  become: yes
  hostname: name=skunkwerkz